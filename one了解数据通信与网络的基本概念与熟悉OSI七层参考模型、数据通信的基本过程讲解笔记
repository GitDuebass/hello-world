今天的课程包括三个模块的内容，帮助大家了解数据网络通信的概念，先有个初步的认识。第二个是关于OSI七层参考模型，在我们数据通信行业是一个非常重要的知识点，包括如何应用这个通信模型去分析我们数据交互的过程。首先我们来了解一下数据网络通信的一些基本概念。首先数据网络data network，就是我们常见的网络设备，路由器、交换机、防火墙、以及负载均衡器等等，一些网络设备根据我们的组网需求，在数据工程师的调试之下搭建起来的一张网络。我们把它称为数据网络。数据网络的基本功能就是让处在各个角落的业务节点之间能够进行相互的通信。而且这个通信又要求是可控的、可靠的、甚至要是安全的，这样一系列的特性。这就是我们数据网络的概念。所以这里是有一些知识点的，比如说两个PC之间一根网线连起来，其实里边蕴含了很多东西。他们通信采用的是什么标准呢？有没有一些相关的协议呢？这协议比如说IP，这个我们数据网络一个非常根本的东西，他定义了我们通信的分组的格式，那么这个分组是什么样的格式呢？我们用IP这个协议来定义。那么这些分组是怎么传输的，他们在网线上是怎么传输的？然后他怎么去寻址的？这些都是作为数据网络都要去考虑的东西。其实整个数据交互的过程是由许许多多的协议在这里头去约束，去规范去做标准化的，这就是我们数通所有学习所要掌握的内容。再一个就是我们要非常清楚我们网络上面承载的数据是什么样的一些数据，这个都是我们要去研究的。另外一种简单的方式，把处在网端的中一些节点连接起来的方式，比较古老的设备，我们把它叫做HUB，叫集线器。实际上对于HUB来讲呢，他确实一个比较古老的设备，可能很多朋友都没有见过。这里为什么要讲呢？其实是为了引出两个概念，第一个概念叫做冲突，对于HUB来讲呢，它是一种中先行的机制，处在同一台HUB，或者连接在同一台HUB上的所有的网元，我们把它叫做处在一个冲突域当中。那么处在同一个冲突域中的两个网元同一时间只能有一个网元在享用这个带宽在发送数据，如果同时有两个网元在发数据的话，就会产生冲突，我们的数据包就会受损。这是所谓的HUB和冲突以及冲突域的概念。那么到后来呢我们又有了网桥，有了交换机，HUB集线器，他的整机是一个冲突域，也就是说连载一台HUB之上的所有节点，他们处在一个冲突域当中。会在数据通信过程中发生冲突的这样一个现象，正是由于有这样的现象，我们才采用相关的机制来规避。后来我们又有了交换机，对于交换机来说呢，他在许多方面都做了一些改良，他是跟HUB完全不一样的设备。交换机有许多基本的功能，比如说他能够把一个作为接入层的设备把我们处在网络最底层的，一些比如说终端、pc、一些网元给他连接起来，给他接入起来，那么他能够，提供数据交换的功能，包括对数据帧进行寻址，交换机的每一个接口是一个单独的冲突域，连接在同一台交换机上的所有的网元，彼此之间不会像HUB那样产生冲突的行为。但是交换机呢他的整机有另外一个概念叫做广播域，也就是说连接在同一台交换机上的所有的节点处于同一个广播域当中。广播域其实很好理解，比如一个房间我来讲台上给大家唱歌，那么这个时候呢在这个房间内的同学你们都要去听我的歌声，可能有些同学说我唱的不好听，有些人不想听，那么不管你想不想听，只要你进了这个屋，你就得享用我的歌声，可能有些人听完之后觉得我去这太难听了，但是没办法你只要进到这个屋子里来了，你就要去耗费一定的资源，去侦听我的这个广播。所以我发送数据的这个行为采用的是一种叫广播的方式。那么整个屋子是一个广播域。那么处于同一个广播域的节点，只要有个节点发送广播，那么整个广播域内的用户呢都会收到这份数据，不管你需不需要，就算你不需要你也要收，收完以后，你可能会把这个包拆开，你可能会发现这个不是我想要的，我再把它给丢弃掉。所以从侧面上可以看到亮点，第一点呢，广播是一种用在特殊场景下的数据传播方式，比如说DHCP、你作为一个PC机你要上网，肯定要有IP地址，IP呢你可以手动来配置，也可以配置DHCP来动态获取，但你要用DHCP来动态获取的时候。你必须要有一个DHCP池，不然谁来给你分地址呢？有一台DHCP的服务器。但是初始情况下呢，可能我并不知道这个DHCP服务器在哪里？所以我可能我要吼一声，DHCP服务器你在哪呢？这个方式其实就是一种广播的行为。因为我不知道DHCP这个服务器在哪对不对？所以这是一个广播应用的场景。但除此之外呢还有很多其他的方式，其他的应用，比如arp的地址解析协议等等。那么第二个点呢关于广播。其实是存在一定的危害的。尤其是在我的网络中存在大量的广播的时候，对于我的网络当中的设备来讲，又是一个非常大的负担。因为每一个节点都要去处理这歌广播数据，即使他不需要这些数据。所以广播增加了我们网络中设备的额外的损耗。所以呢广播呢是有一定的危害的。那么这就是为什么我们在做组网设计的时候，会试图去减小广播域的大小，这样就可以减小这个广播产生的影响。正是由于这点呢，我们将IPV4呢换代为IPV6，在IPV6当中呢就取消了广播。除此之外呢还有两种方式，单播和组播。那所谓的单播的话呢，就是A发数据给B，只有B会受到数据，点对点的通信。组播是一种一对多的应用，比如视频、多媒体这样的应用。他是一对多的。这个倒后面再给大家讲。网络交换机的基本功能，首先是数据帧的交换。然后能够提供终端设备的接入，满足一些基本的接入安全功能，比如MAC地址的过滤呢等等，ARP的欺骗呢等等。然后广播域的隔离，二层链路的冗余，防环以及负载均衡。这些就是交换机的基本功能。我们说了连接在同一台交换机上的所有的节点或者说网元，他们都处在处在同一个广播域当中的，我们往往又会说他们处在同一个LAN当中.这个时候呢说一个广播域一般来讲呢是一个逻辑子网，不同的广播域呢往往是不通的逻辑子网，所以呢这个时候呢对于这个交换机来讲呢，他就构成这样的一个网络LAN1.对于右侧的交换机来说呢他又构成了另一个lan。那么同一个LAN上的PC之间他们的通信行为，我们把它叫做二层通信。为什么叫二层通信呢？等会儿会解释。他们是同一个网段内的这种通信，我们把它称作二层通信。他们之间的通信是没有任何问题的。只要把他们配置了正确的IP地址，那么他们就能够进行一个相互的通信。但是这两个LAN之间是没法进行相互通信的。因为他们处在不通的LAN。不通的逻辑子网。那这个我时候呢为了让两个LAN之间呢能够进行相互的通信，我们就要借助第三台设备叫做路由器。路由器他的基本功能就是可以隔绝广播。交换机呢他的整机是一个广播域，但是路由器呢，一个接口，就是一个广播域。这个接口是广播域A这个解释是广播域B，所以通常来讲，路由器不通的接口是不同的广播域，又是不通的逻辑子网。你试着给一个路由器的两个接口配置同一个网段的IP地址，他是会报错的，同时呢他可以实现跨三层的数据互访。 为什么等一会儿再讲？除此之外呢？路由器还能改支持路由协议，来维护路由表，在这个层面上来讲呢？路由器就像我们现实生活中的车站，地铁站的概念。一个数据网络呢往往包含着无数个路由器，就像我们现实生活中有许许多多的车站是一个道理，那么数据网络的一个基本功能就是要把数据从一个数据源"搬运"到目的地去。对于现实的车站来讲就是要把各个这站的人送到目的地去。这个时候呢你就可以吧这个想象成一个数据网络，车站就是姨太太的路由器。那么人呢是先到了我的这个车站，车站会去觉决策我把这个送到哪个目的地去。那么这种行为呢在网络中叫做路由。所以所谓的路由就是指我的路由器或者其他具有路由功能的设备，当我收一个IP数据包的时候，那我会查看这个数据包，他要去哪里？比如说他目的IP地址是什么？然后再拿着他的目的IP地址在路由器的地图中也叫做路由表中进行相应的查找，那么当他查到一个匹配的表项，那么就会按照这个表项所指示的接口和下一跳的IP地址去转发，把这个数据包发出去，这个行为叫做路由。所以路由是路由器的一个非常基本的功能。路由器呢会去决策哪个路径是最优的，然后把这个数据包转发出去。除此之外呢，当然他还有其他丰富的功能，比如说能够实现广域网接入，NAT地址转换，以及一些特定的安全功能。从外观上来看我们的路由器呢，他的端口的数量，物理接口的数量，往往会比交换机少一些。所以越来越多的网络设备，随着我们网络规模的逐渐变大，会加入到网络中来。变成网络的一部分。所以随着我们网络规模越大，网络中设备的数量价格包括他的功能可能更丰富更昂贵。那么当然对于我们数据通信的工作，挑战也就更高。所以我们要去掌握各种设备，他的性能，他的功能，掌握这些设备的调试方式，掌握工作在这种设备上的工作协议，一些技术，他的一些原理。尤其是对于专门做数通领域的一些工程师的话呢，我们甚至要去深入的了解每一个协议底层的工作，报文都是要去了解的。所以网络的复杂程度会越来越高。当然追根究底，我们的网络都是要去为客户的网络需求去服务的，所以怎么样把我们所学的技术啊按照实际的业务逻辑变成相应的配置，把这个设备给他搞活，这个才是我们真正有价值的地方。所以所谓的网络拓扑就是由各种设备线缆标示构成的一个用来描述网络的逻辑架构的一个图。这个对于数通通信工程师也是一项必备的技能。我个人比较喜欢总结，我把一个数通工程师成长的过程呢分为五个阶段。就好像是你修了一门武功，第一层，第二层，第三层，第四层，第五层。首先要学这个东西是什么？比如什么是路由什么是交换？在这个基础上呢要了解一下这怎么用，怎么去用它，比如说我们要学OSPF怎么去用呢？交换机怎么去用呢？VLAN怎么去用呢？当然这个时候还是比较肤浅比较浅显。这个时候呢不仅仅要知道他是什么他怎么用，还要知道他怎么去工作的，他的交互的一个过程是怎样的？这样呢你才算是真正的搞懂了。当网络出现一些问题的时候你才知道怎么去定位，怎么去排除故障。否则你就一头雾水，根本不知道是怎么回事，这儿不通了，那个PING不通了，业务断了，你就只能停留在这个层面。所以一定要往上走，当然这还是不够的，这顶多算是一个小牛。你要想成为一个大牛呢？你就要再深入，深入到什么程度呢？你要了解协议他最底层的工作机制，细到什么程度呢？细到这个协议他的报文的每一个字段，关键的字段的作用是什么？我们的每一个协议要能正常工作，往往都需要这个协议底层做一些报文交互，才能进行正常工作的。你比如说我们两个人聊天，是不是要对话，我一句话里边可能包含着很多字词词组语句。这个跟我们数据网络的世界是完全一样的，数据网络的世界呢除了有我们实际的业务数据在里边走，还有一些网络的协议的数据在里边走，那么这些数据很像我们话里的词词组啊等等。成长到这个程度呢才算是个大牛。 这个时候我们视野就打开了，可能我们就站在整个数据网络，宏观的一个东西怎么去规划，实施，排错，优化。在部署的时候需要注意些什么事项，保证在后续的网络工作最可靠最健壮。前面就当时扫盲了，接下来是今天的重点。网际互联及OSI七层模型。他是一个参考模型，他一共有七个层次。每一个层次呢都有自己的功能定义，实现相应的功能，这就有点类似于A跟B公司，他们之间要进行一个业务的往来。 最高层是CEO可能通过一顿饭就谈妥了这项业务，但是要具体的部门来经办。比如他有秘书、商务部、财务部、运输部等等。 整个业务呢是从上往下，其实是两边的CEO业务流量的一个交互。这个东西肯定不可能直接穿越过去对吧，我还是需要码农啊啥的把这些数据送过去。比如秘书书写啊，财务部盖章啊，加个信封写上原地址目的地址，，，最后快递员送到B。B拿到之后拆信封，层层往上。可以把公司替换成两台电脑，其实电脑都有各个部件。OSI呢他是Open System Interconnect开放系统互连参考模型，是由ISO（国际标准化组织）定义的。它是个灵活的、稳健的和可互操作的模型，并不是协议，而是一个伟大的模型。这个模型他规范不同系统的互联标准，因为做网卡的有很多厂家，比如做文件传输的有很多软件，那么这些软件是怎么互通的，为什么我换一个软件也能用呢？这是因为底层的各个部件之间呢都有相应的标准化来要求的，这样使得各个厂家的部件可以实现对接。才能使得今天这个互联网使得整个通信网络得到这么快速的一个发展，所以足见这个模型是多么伟大的。OSI把网络按照层次分为七层，由下到上分别为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。他有很多优点，比如说我们买组装机，里边有CPU啊内存啊有显卡声卡啊这些东西，做CPU的公司他就专注在CPU的开发上，做内存的公司他就专注在内存的开发上，并且cpu和内存又是可以配合工作相互兼容的，这样呢我们又可以让每个厂商服务提供商都能专注在自己擅长的哪个领域去开发，才能让产业的标准化得到一个很好的保障。然后每个部件又能实现无缝的对接。这个模型确实是个给长牛逼的模型对吧。长什么样呢？一共是七个层次，这个得背下来。由下到上分别为物理层、数据链路层、网络层、传输层、会话层、表示层、应用层。一共是七个层次，越往上呢与我们人越近。骇客帝国大家都有看过吧，那哥们世界万事万物都是有二进制构成的，学完这个OSI参考模型之后呢往后我们看一个计算机设备你就要拿这个模型去套。你看一台计算机的时候，你就要知道他有七个层次都有。看到路由器的时候他可能有下面三个层次（网络侧、数据链路层、物理层），看到一台路由交换机的时候他可能只有下面两个层次（数据链路层、物理层），看到一根网线的时候他就一个层次（物理层），那么上面三个层次是负责高层的东西，往往我们把它称为系统层。下面四个层次呢就要关注怎么样把上面系统层下来的数据从源搬运到目的地去。不仅仅要考虑搬过去，可能还要考虑多种因素，比如要考虑速度的可靠性，有没有被损坏啊，有没有被丢弃啊等等他的寻址啊都要考虑的，都由下面四个层次来完成。所以每一个部件他的功能，应用层呢是定义了各种应用程序，各种协议和标准。注意这里所说的应用程序并不是说QQ之类的东西，那是软件。 不是我们这里所说的应用程序。应用程序是什么呢？比如说Telnet、http。上网在浏览器中输入的http://...，浏览器本身是个软件，这个软件呢他底层工作的协议在我们浏览WEB网页的时候，是用了这个http这个协议。超文本传输协议。他能够为我们呈现多媒体的信息，文字啊等等。这个才是我们应用层标准的协议。往下呢就是表示层。是做一些数据格式的转换，以确保一个系统生成的应用层数据能够被另外一个系统的应用层所识别和理解。会话层就是节点之间的会话建立维护注销等等。那么上面这三个层次呢我们统称为系统层。往往是由系统来实现。那么下面这四个层次就要关注了啊。我们怎么把从上面下来的数据从我这儿搬运到甚至是跨国搬运。首先传输层呢是提供一个可靠或不可靠的端到端传输。网络层呢是提供一个数据寻址啊，路由的一些方式啊，路由协议啊等等。再往后就是数据链路层，在网络层呢关注的是我这个数据的源和目的地。这个源可能在中国，目的地可能在美国。对于网络层他只关心从中国到美国。数据链路层是干嘛的呢？你从中国到美国，数据不可能穿越过去，我们一点一点的一段链路一段链路的这么来传播。当然可能这个传播过程中他的链路是多种多样的，有的可能是以太网链路啊，有的可能是郑中基的链路啊，有的可能是ppp的链路啊，那么这个就是链路层要关注的，怎么把数据从一端传到另一端去。怎么把数据封装成帧，提供一个节点到节点或者说一个链路到一个链路的传输，协商比如说差错校验啊，二层的寻址啊等等。最后数据在最底层也就是物理层呢被转换成了比特流，通过网线光纤这样的介质来传递。不管是网线还是光纤，这些接口都是在物理层定义。所以这就是整个OSI的参考模型。那么每一层呢都有自己的功能，那么层与层之间呢，他及时相互独立的，又是相互依靠的。接下来我们来详细看下每一个层次他的基本内容。最高层是应用层，那么这些应用程序，一定要注意跟我们的软件做一个区分。比如说浏览器，浏览访问webd的时候其实是他底层的http协议在工作，是他来帮忙实现网页的访问。所以这些工作在应用层的这样一些程序大家要做一些了解。除此之外呢还有一些比如说ftp（20/21）等等都是应用层的协议。这些端口号20/21是对应的传输层的端口号。其实我们数据网络要传输的数据往往是在应用层产生的，比如我们下载图片，啥的是http协议在运作。往下呢就是表示层呢是对数据的解码编码，加密解密，压缩解压缩等等，这里呢有一些标准，比如ASCII码，JPEG等。会话层呢他是负责建立管理和终止表示层实体之间的会话连接。基本上765三个层次实现的功能其实在TCP/IP就把他整合起来了，没有区分的这么清楚。对于这三个层次做一些基本的了解就好。往下呢就是传输层是负责将来自上层应用程序的数据进行分段和重组，并将他们组合为同样的数据流形式。然后提供端到端的数据传输服务，在下节课讲TCP安全模型的时候会给大家介绍，工作在传输层的协议有两种：TCP（提供可靠的传输）UDP（提供尽力而为的传输），再往下就是网络层，他定义了逻辑地址（三层地址），这里为什么叫三层地址呢，其实我这里网络层从下往上就是在第三个层次，在我们的TCP/IP网段中工作在网络层的最著名的协议就是IP。网际互联协议。正是他来定义了整个IP分组模式，我们的数据或者说节点，在一个IP网络中，要能够进行正常的通信，那么前提是所有的节点必须具备一个地址，而且必须是唯一的，那么这个地址他就是个逻辑地址。三层地址对于IP协议来说他就是个IP地址。然而实际上网络层的协议不只IP这么一个，但是随着行业的发展IP协议取代了成为了老大，定义了地址，实现分组存执，负责将分组数据从源端传输到目的端，实现路由选择，维护路由表。这些都是在网络层上定义的。作为工作在网络层的一台设备，大家最为熟知的就是路由器。路由器功能有：实现广播组播隔绝，寻址及数据转发，选择到达目的网络的最佳路径。我们分数据呢，比如说这是数据的荷载，我们叫payload。其实我们最终的目的是要把数据从源送到目的地去。比如你写一封信，从我这儿送到目的地去，我是不是得给这个信套上信封呢，在信封上是不是要一个源和目的地地址呢，这个时候目的地地址就非常重要，他是作为我们路由器在收到这个信封的时候他去寻址的关键的东西。他会拿着这个目的地地址在路由表中，路由表中又放了很多表项，进行一一查找，直到找到一个表项，匹配的，这个表项呢比如说有个出接口，还有一个下一站的IP地址，那么他就会往这个出接口和这个下一站IP地址转发出去。所以路由器呢支持路由协议维护路由表。 IP地址就像我们的门牌号，在IP网络中，它可以标示一个接口或一个节点。如果你的PC有多个网卡，每个网卡都可以配一个IP地址。这样就可以通过这个网卡收发数据包。路由定义：当我们的路由器或者其他的三层设备，在我收到一份IP数据包的时候，我去查看这个数据包的包头，那么在这个包头上面写的目的地址，我会拿着这个目的地地址在路由表中，路由表中又放了很多表项，进行一一查找，直到找到一个匹配的表项，这个表项呢比如说有个出接口，还有一个下一站的IP地址，那么他就会往这个出接口和这个下一站IP地址转发出去。 当然如果我没有找到任何的匹配这个目的地的表项，那么我就会直接把这个数据包丢弃掉。那么对于网络层呢我们之关系这个数据从这儿来到那儿去。他的源和目的。当然其实这个数据他不可能穿越过来对吧~~真正的传输过程是数据链路层要考虑的。当然两个节点之间选择最优线路是网络层路由器来决定的。所以数据链路层就是负责把从网络层下来的东西封装成帧，然后写入数据帧帧头一些相应的字段，使得我们这个数据帧能够从链路的一端传到另外一端去。这叫做组帧。所以呢数据链路层在物理层基础上向网络层提供服务。他的协议很多，比如局域网的数据链路层协议有以太网等。对于数据链路层的地址叫MAC地址（寻址用）。往往被我们称为硬件地址。比如说电脑的网卡，一个网卡就有一个MAC地址，而这个MAC地址是在网卡出厂的时候被烧录在网卡当中的。这就是为什么我们把它称为MAC地址。MAC地址一共有48位，或者叫48比特长度（二层地址）（16进制表示），IP地址是32个比特（三层地址）（点分十进制表示），注意他们的作用是不一样的，IP地址是帮助我们寻址从源送到目的地去。而MAC地址也是帮我们寻址，但是她是从链路层面上寻址从一个点送到另一个点。MAC地址其实是分成两部分的，前面24比特是厂商的标示，是需要去IEEE去申请的，后面24个比特就是厂商自由分配的，所以对于MAC地址来讲呢，他也是全球唯一的。但是在我们通信领域当中，一个MAC地址的有效范围或者说工作范围只在链路link层面上，或者说只在LAN当中（同一个IP网段）。与身份证名字（IP地址）和小名（MAC）类似，小名只有在家里才认识你，出去就没人认识你啦。注意A到B，必须要有IP地址，也要MAC地址，缺一不可。交换机是工作在数据链路层的代表性设备。交换机用于MAC寻址的。最后是物理层。顾名思义，他是定义了一些电缆，接口、物理拓扑等等，他是负责把逐个的比特从一跳（结点）传到另一跳（结点）。比如说定义了接口及连接器的类型，比如如水晶头，他是有标准的，这个标准是RJ45，这些都是在物理层上定义的。工作在物理层的代表设备就一个了，HUB集线器。连接在同一台HUB上的所有节点都处在同一个冲突域中，所以同一时间，只能有一个节点在享用HUB的带宽。网络中传输的数据，称为荷载payload。加信封的过程我们叫封装，其实封装的是头部地址。最后再网线中以比特流传到目的地。
